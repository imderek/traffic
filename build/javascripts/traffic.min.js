/*! traffic 2014-09-03 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};this.Car=function(){function b(){this.move_along_road=a(this.move_along_road,this),this.can_move_forward=a(this.can_move_forward,this),this.has_reached_end_of_road=a(this.has_reached_end_of_road,this),this.leave_road=a(this.leave_road,this),this.enter_road=a(this.enter_road,this),this.update=a(this.update,this),this.active=!0,this.color="rgba(39,127,182,1)",this.road=null,this.x=this.y=0,this.velocity=Math.floor(4*Math.random()+1),this.size=15}return b.prototype.update=function(){return this.has_reached_end_of_road()?this.leave_road():this.can_move_forward()?this.move_along_road():void 0},b.prototype.enter_road=function(a){return this.road=a,this.x=this.road.x_start,this.y=this.road.y_start},b.prototype.leave_road=function(){return this.active=!1,this.road.cars.pop()},b.prototype.has_reached_end_of_road=function(){return this.x>=this.road.x_end&&this.y>=this.road.y_end},b.prototype.can_move_forward=function(){return this.active&&this.road.active},b.prototype.move_along_road=function(){var a,b,c;return a=Math.atan2(this.road.y_end-this.y,this.road.x_end-this.x),b=Math.cos(a)*this.velocity,c=Math.sin(a)*this.velocity,this.x=this.x+b,this.y=this.y+c},b.prototype.draw=function(){return world.canvas.beginPath(),world.canvas.arc(this.x,this.y,this.size+4,0,2*Math.PI),world.canvas.fillStyle="#fff",world.canvas.fill(),world.canvas.beginPath(),world.canvas.arc(this.x,this.y,this.size,0,2*Math.PI),world.canvas.fillStyle="rgba(39,127,182,1)",world.canvas.fill(),world.canvas.beginPath(),world.canvas.arc(this.x,this.y,this.size-5,0,2*Math.PI),world.canvas.fillStyle="#fff",world.canvas.fill(),world.canvas.beginPath(),world.canvas.arc(this.x,this.y,2,0,2*Math.PI),world.canvas.fillStyle="rgba(39,127,182,1)",world.canvas.fill(),world.canvas.beginPath(),world.canvas.arc(this.x,this.y,3.5*this.size,0,2*Math.PI),world.canvas.fillStyle="rgba(39,127,182,0.05)",world.canvas.fill()},b}()}).call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};this.Road=function(){function b(b,c,d,e,f){null==b&&(b=100),null==c&&(c=650),null==d&&(d=100),null==e&&(e=100),null==f&&(f=0),this.events=a(this.events,this),this.draw=a(this.draw,this),this.update=a(this.update,this),this.active=!0,this.cars=[],this.x_start=b,this.x_end=c,this.y_start=d,this.y_end=e,this.events()}return b.prototype.update=function(){},b.prototype.draw=function(){return world.canvas.lineWidth=4,world.canvas.lineCap="round",world.canvas.strokeStyle="#666",world.canvas.beginPath(),world.canvas.moveTo(this.x_start,this.y_start),world.canvas.lineTo(this.x_end,this.y_end),world.canvas.stroke()},b.prototype.events=function(){return $("canvas").on("click",function(a){return function(){return a.active=a.active?!1:!0}}(this))},b}()}.call(this),function(){$(function(){return window.world=new World,setInterval(function(){return world.update(),world.draw()},1e3/world.fps)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};this.World=function(){function b(){this.build_roads=a(this.build_roads,this),this.canvas_width=$(window).width(),this.canvas_height=$(window).height()-4,this.fps=60,this.canvas_element=$("<canvas width='"+this.canvas_width+"' height='"+this.canvas_height+"'></canvas"),this.canvas=this.canvas_element.get(0).getContext("2d"),this.canvas_element.appendTo("body"),this.roads=[],this.build_roads()}return b.prototype.build_roads=function(){var a,b,c,d;return this.roads.push(new Road(b=380,a=380,d=30,c=650)),this.roads.push(new Road(b=70,a=920,d=330,c=330))},b.prototype.update=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(i=this.roads,c=0,f=i.length;f>c;c++)for(b=i[c],b.update(),j=b.cars,d=0,g=j.length;g>d;d++)a=j[d],a.update();for(k=this.roads,l=[],e=0,h=k.length;h>e;e++)b=k[e],0===b.cars.length?(a=new Car,b.cars.push(a),l.push(a.enter_road(b))):l.push(void 0);return l},b.prototype.draw=function(){var a,b,c,d,e,f,g,h,i;for(this.canvas.clearRect(0,0,this.canvas_width,this.canvas_height),g=this.roads,c=0,e=g.length;e>c;c++)b=g[c],b.draw();for(h=this.roads,i=[],d=0,f=h.length;f>d;d++)b=h[d],i.push(function(){var c,d,e,f;for(e=b.cars,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a.draw());return f}());return i},b}()}.call(this);